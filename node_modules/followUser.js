/* followUser.js 
 * Provides functionality for following users 
 */ 
 
var dbAccess = require('dbAccess'), 
	users = require('users'), 
	url = require('url');

/* follow 
 * Exposes functionality for following another user when logged in 
 *
 * @param req A node http request object 
 * @param res A node http response object 
 */ 
exports.follow = function(req, res) { 
	req.getUser(function(error, user) { 
		if (error || !user) { 
			throw error; 
		}
		else { 
			var userId = user.id; 
			var urlQuery = url.parse(req.url, true).query; 
			var userIdToFollow = urlQuery.id; 
			users.followUser(userId, userIdToFollow, function(error) { 
				if (error) console.log(error); 
				res.writeHeader(200, {'Content-Type': 'text/html'});
				res.end('<html><script language="JavaScript"> self.location="viewProfile?id=' + userIdToFollow + '"; </script></html>');
			}); 
		}
	}); 
}

/* unfollow 
 * Exposes functionality for unfollowing another user when logged in 
 *
 * @param req A node http request object 
 * @param res A node http response object 
 */
exports.unfollow = function(req, res) { 
	req.getUser(function(error, user) { 
		if (error || !user) { 
			throw error; 
		}
		else { 
			var userId = user.id; 
			var urlQuery = url.parse(req.url, true).query; 
			var userIdToFollow = urlQuery.id; 
			users.unfollowUser(userId, userIdToFollow, function(error) { 
				res.writeHeader(200, {'Content-Type': 'text/html'});
				res.end('<html><script language="JavaScript"> self.location="viewProfile?id=' + userIdToFollow + '"; </script></html>');
			}); 
		}
	}); 
}
