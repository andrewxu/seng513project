var path = require('path'),
	fs = require('fs'),
	util = require('util'),
	settingsFile = 'config.js',
	settings;

var loadSettings = function() {
	// Set the defaults first
	var defaults = new Array();
	
	//*******************************
	// DEFINE DEFAULT SETTINGS HERE!
	//*******************************
	defaults.db_file = 'db/CivicConnect.db';
	defaults.email_account = 'civicconnect@gmail.com';
	defaults.email_password = '';
	defaults.email_smtp_server = 'smtp.gmail.com';
	
	if (path.existsSync(settingsFile)) {
		eval(fs.readFileSync(settingsFile, encoding="ascii"));
		// Check that it was loaded correctly
		if (!settings) {
			util.log('Error loading settings from ' + settingsFile + '. Using defaults.');
			settings = defaults;
		}
		else {
			// Now check that each setting was loaded okay, otherwise use a default
			for (i in defaults) {
				if (settings[i] == undefined) {
					settings[i] = defaults[i];
					util.log('Application setting ' + i + ' was not loaded from ' + settingsFile + 
						". Using default value '" + defaults[i] + "'.");
				}
			}
			util.log('Loaded application settings from ' + settingsFile);
		}
	}
	else {
		settings = defaults;
		util.log(settingsFile + ' not found. Using default settings.');
	}
};

exports.getSetting = function(settingKey) {
	// If we haven't already loaded from the file, load it
	if (!settings) {
		loadSettings();
	}
	return settings[settingKey];
}
